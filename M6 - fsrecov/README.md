# LAB - M6
https://jyywiki.cn/OS/2024/labs/M6.md  

## 思路
持久化是操作系统三个pieces中最麻烦的，因为要跟实际的存储设备打交道，没那么自由  
没足够的时间看FAT Specification，本实验打算以参考其他解答为主
目标是完成最小任务

### 前置知识
- FAT32文件系统结构
- Bitmap图片格式


### 初步理解
图片在FS中的存储，理想情况是连续的，可能会有部分图片分块
在FS格式化後，FAT表被清空，图片数据应保留原处

根据文档，大致的恢复流程如下：
1. 顺序扫描镜像的每个cluster
2. 标记数据，分类为4种之一：
    - 目录文件
    - BMP文件头部
    - BMP文件数据
    - 未使用
3. 根据手册恢复目录项，得到文件名和cluster ID
4. 匹配到对应的cluster，根据文件大小恢复
5. 对于破碎的文件或cluster，~~使用启发式算法找後继~~直接放弃
6. 对每个恢复的文件，先写入，再调用popen读取并输出



### 困难解决


## 实现注意点


## 遗留问题


## 其他解答
以前，本实验名称为`frecov`，今年加了个`s`，搜索时可注意

